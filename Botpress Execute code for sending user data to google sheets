try {
  // 1️⃣ Read workflow variables from Botpress state
  const vars = event.state.session?.current_workflow?.variable_values;

  if (!vars) {
    console.log("Workflow variables not found");
    return;
  }

  const name = vars.username;
  const phone = vars.phone;

  if (!name || !phone) {
    console.log("Missing name or phone", { name, phone });
    return;
  }

  // 2️⃣ Prepare payload
  const payload = {
    name: name,
    phone: phone,
    source: "Gym Bot"
  };

  console.log("Sending payload:", payload);

  // 3️⃣ Send to Google Apps Script (NO headers)
  await fetch("https://script.google.com/macros/s/AKfycbx9Kb3Th6ceSyuROsFoz_-ttEqCPWRLnRyzYCh6KGD51moCqTPobqH7QzfDDc3RHPql/exec", {
    method: "POST",
    body: JSON.stringify(payload)
  });

  console.log("Lead successfully sent to Google Sheets");

} catch (error) {
  console.error("EXECUTE CODE ERROR:", error.message);
}


